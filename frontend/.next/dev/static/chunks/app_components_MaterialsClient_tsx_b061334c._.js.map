{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kristo/playbook-crm/frontend/app/components/MaterialsClient.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useState } from \"react\";\n\ntype Material = {\n  id: number;\n  title: string;\n  mime_type: string;\n  tags: any[];\n  file: string | null;\n  extracted_text: string;\n  created_at: string;\n};\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE_URL || \"\";\n\nfunction getCookie(name: string): string {\n  if (typeof document === \"undefined\") return \"\";\n  const parts = document.cookie.split(\";\").map((v) => v.trim());\n  for (const p of parts) {\n    if (p.startsWith(`${name}=`))\n      return decodeURIComponent(p.slice(name.length + 1));\n  }\n  return \"\";\n}\n\nasync function apiJson<T>(path: string, init?: RequestInit): Promise<T> {\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...init,\n    headers: {\n      ...(init?.headers || {}),\n    },\n    credentials: \"include\",\n  });\n\n  if (!res.ok) {\n    let detail = \"\";\n    try {\n      const data = await res.json();\n      detail = data?.detail ? String(data.detail) : JSON.stringify(data);\n    } catch {\n      detail = await res.text();\n    }\n    throw new Error(detail || `Request failed: ${res.status}`);\n  }\n\n  return res.json();\n}\n\nexport default function MaterialsClient() {\n  const [loading, setLoading] = useState(true);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const [materials, setMaterials] = useState<Material[]>([]);\n  const [query, setQuery] = useState(\"\");\n\n  const [title, setTitle] = useState(\"\");\n  const [tagsText, setTagsText] = useState(\"\");\n  const [file, setFile] = useState<File | null>(null);\n\n  async function loadMaterials() {\n    setError(\"\");\n    const data = await apiJson<Material[]>(\"/api/materials/\");\n    const sorted = [...data].sort((a, b) => {\n      const ad = new Date(a.created_at).getTime();\n      const bd = new Date(b.created_at).getTime();\n      return bd - ad;\n    });\n    setMaterials(sorted);\n  }\n\n  useEffect(() => {\n    let mounted = true;\n\n    async function load() {\n      setLoading(true);\n      setError(\"\");\n      try {\n        await loadMaterials();\n      } catch (e: any) {\n        if (!mounted) return;\n        setError(e?.message || \"Failed to load materials\");\n      } finally {\n        if (!mounted) return;\n        setLoading(false);\n      }\n    }\n\n    load();\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  const filtered = useMemo(() => {\n    const q = query.trim().toLowerCase();\n    if (!q) return materials;\n\n    return materials.filter((m) => {\n      const t = (m.title || \"\").toLowerCase();\n      const tags = Array.isArray(m.tags)\n        ? m.tags.map((x) => String(x).toLowerCase()).join(\" \")\n        : \"\";\n      const mt = (m.mime_type || \"\").toLowerCase();\n      return t.includes(q) || tags.includes(q) || mt.includes(q);\n    });\n  }, [materials, query]);\n\n  async function upload() {\n    const t = title.trim();\n    if (!t) {\n      setError(\"Title is required\");\n      return;\n    }\n    if (!file) {\n      setError(\"File is required\");\n      return;\n    }\n\n    setUploading(true);\n    setError(\"\");\n\n    try {\n      const tags = tagsText\n        .split(\",\")\n        .map((s) => s.trim())\n        .filter(Boolean);\n\n      const fd = new FormData();\n      fd.append(\"title\", t);\n      fd.append(\"tags\", JSON.stringify(tags));\n      fd.append(\"file\", file);\n\n      const csrf = getCookie(\"csrftoken\");\n\n      const res = await fetch(`${API_BASE}/api/materials/`, {\n        method: \"POST\",\n        body: fd,\n        credentials: \"include\",\n        headers: csrf ? { \"X-CSRFToken\": csrf } : undefined,\n      });\n\n      if (!res.ok) {\n        let detail = \"\";\n        try {\n          const data = await res.json();\n          detail = data?.detail ? String(data.detail) : JSON.stringify(data);\n        } catch {\n          detail = await res.text();\n        }\n        throw new Error(detail || `Upload failed: ${res.status}`);\n      }\n\n      setTitle(\"\");\n      setTagsText(\"\");\n      setFile(null);\n      await loadMaterials();\n    } catch (e: any) {\n      setError(e?.message || \"Upload failed\");\n    } finally {\n      setUploading(false);\n    }\n  }\n\n  if (loading) {\n    return <div className=\"tw-p-6 tw-text-slate-200\">Loading…</div>;\n  }\n\n  return (\n    <div className=\"tw-flex tw-h-full tw-w-full tw-gap-4 tw-p-6 tw-text-slate-200\">\n      <div className=\"tw-w-[420px] tw-shrink-0 tw-rounded-2xl tw-border tw-border-slate-700 tw-bg-slate-900 tw-p-4\">\n        <div className=\"tw-text-xl tw-font-semibold\">Materials</div>\n        <div className=\"tw-mt-1 tw-text-sm tw-text-slate-400\">\n          Upload files you can attach to playbook steps.\n        </div>\n\n        <div className=\"tw-mt-4 tw-rounded-2xl tw-border tw-border-slate-800 tw-bg-slate-950 tw-p-4\">\n          <div className=\"tw-text-sm tw-font-semibold tw-text-slate-300\">\n            Upload\n          </div>\n\n          <div className=\"tw-mt-3 tw-flex tw-flex-col tw-gap-3\">\n            <label className=\"tw-text-xs tw-text-slate-400\">\n              Title\n              <input\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                className=\"tw-mt-1 tw-w-full tw-rounded-xl tw-border tw-border-slate-700 tw-bg-slate-900 tw-px-3 tw-py-2 tw-text-slate-200\"\n              />\n            </label>\n\n            <label className=\"tw-text-xs tw-text-slate-400\">\n              Tags (comma separated)\n              <input\n                value={tagsText}\n                onChange={(e) => setTagsText(e.target.value)}\n                className=\"tw-mt-1 tw-w-full tw-rounded-xl tw-border tw-border-slate-700 tw-bg-slate-900 tw-px-3 tw-py-2 tw-text-slate-200\"\n              />\n            </label>\n\n            <label className=\"tw-text-xs tw-text-slate-400\">\n              File\n              <input\n                type=\"file\"\n                onChange={(e) => setFile(e.target.files?.[0] || null)}\n                className=\"tw-mt-1 tw-w-full tw-rounded-xl tw-border tw-border-slate-700 tw-bg-slate-900 tw-px-3 tw-py-2 tw-text-slate-200\"\n              />\n            </label>\n\n            <button\n              onClick={upload}\n              disabled={uploading}\n              className=\"tw-rounded-xl tw-bg-gradient-to-r tw-from-[#3874CB] tw-to-[#A1FCDD] tw-px-3 tw-py-2 tw-font-semibold tw-text-slate-900 disabled:tw-opacity-60\"\n            >\n              {uploading ? \"Uploading…\" : \"Upload material\"}\n            </button>\n          </div>\n        </div>\n\n        {error ? (\n          <div className=\"tw-mt-3 tw-text-sm tw-text-red-300\">{error}</div>\n        ) : null}\n      </div>\n\n      <div className=\"tw-flex-1 tw-rounded-2xl tw-border tw-border-slate-700 tw-bg-slate-900 tw-p-4\">\n        <div className=\"tw-flex tw-items-center tw-justify-between tw-gap-3\">\n          <div className=\"tw-text-sm tw-font-semibold tw-text-slate-300\">\n            Library ({filtered.length})\n          </div>\n\n          <input\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n            placeholder=\"Search title, tags, type…\"\n            className=\"tw-w-[320px] tw-rounded-xl tw-border tw-border-slate-700 tw-bg-slate-950 tw-px-3 tw-py-2 tw-text-slate-200\"\n          />\n        </div>\n\n        {filtered.length === 0 ? (\n          <div className=\"tw-mt-4 tw-text-sm tw-text-slate-400\">\n            No materials yet.\n          </div>\n        ) : (\n          <div className=\"tw-mt-4 tw-grid tw-grid-cols-2 tw-gap-3\">\n            {filtered.map((m) => (\n              <div\n                key={m.id}\n                className=\"tw-rounded-2xl tw-border tw-border-slate-800 tw-bg-slate-950 tw-p-4\"\n              >\n                <div className=\"tw-flex tw-items-start tw-justify-between tw-gap-2\">\n                  <div className=\"tw-text-sm tw-font-semibold tw-text-slate-200\">\n                    {m.title}\n                  </div>\n                  <div className=\"tw-text-xs tw-text-slate-500\">#{m.id}</div>\n                </div>\n\n                <div className=\"tw-mt-1 tw-text-xs tw-text-slate-500\">\n                  {m.mime_type || \"file\"}\n                </div>\n\n                {Array.isArray(m.tags) && m.tags.length ? (\n                  <div className=\"tw-mt-2 tw-flex tw-flex-wrap tw-gap-1\">\n                    {m.tags.slice(0, 8).map((t, idx) => (\n                      <div\n                        key={`${m.id}-tag-${idx}`}\n                        className=\"tw-rounded-lg tw-border tw-border-slate-800 tw-bg-slate-900 tw-px-2 tw-py-1 tw-text-[11px] tw-text-slate-300\"\n                      >\n                        {String(t)}\n                      </div>\n                    ))}\n                  </div>\n                ) : null}\n\n                {m.file ? (\n                  <a\n                    href={m.file}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                    className=\"tw-mt-3 tw-inline-block tw-text-xs tw-text-slate-300 tw-underline\"\n                  >\n                    Open file\n                  </a>\n                ) : null}\n\n                {m.extracted_text ? (\n                  <div className=\"tw-mt-3 tw-text-xs tw-text-slate-400 tw-line-clamp-4\">\n                    {m.extracted_text}\n                  </div>\n                ) : null}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}